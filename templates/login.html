<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login - Smart CropX</title>
  <link rel="manifest" href="/manifest.json">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg,#a8edea 0%,#fed6e3 100%);
      font-family: Segoe UI, Roboto, Arial, sans-serif;
    }
    .logo {
  font-family: 'Pacifico', cursive;
  font-size: 48px;
  text-align: center;
  margin-top: 32px;
  margin-bottom: -16px;
  background: linear-gradient(90deg, #fb0000ff, #6453d3ff, #2200ffff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text; /* for Firefox */
}
    .card {
      max-width: 520px;
      margin: 48px auto;
      padding: 24px;
      border-radius: 12px;
    }
    .bubble {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, 
              rgba(255,255,255,0.8), 
              rgba(173,216,230,0.6), 
              rgba(255,182,193,0.5), 
              rgba(255,255,255,0.3));
  box-shadow: 0 0 12px rgba(255,255,255,0.4);
  pointer-events: none; /* bubbles don’t block clicks */
  animation: floatBubble linear infinite;
}

@keyframes floatBubble {
  0%   { transform: translateY(0) scale(1); opacity: 0.8; }
  50%  { transform: translateY(-60px) scale(1.2); opacity: 1; }
  100% { transform: translateY(0) scale(1); opacity: 0.8; }
}

  </style>
</head>
<body>
  <div class="logo">CropX</div>
  <div style="position: relative; max-width: 520px; margin: auto;">
  <!-- Rainbow bubbles with different speeds/delays -->
  <div class="bubble" style="width:40px;height:40px;top:-30px;left:-30px;animation-duration:7s;animation-delay:0s;"></div>
  <div class="bubble" style="width:25px;height:25px;top:20px;right:-25px;animation-duration:5s;animation-delay:1s;"></div>
  <div class="bubble" style="width:30px;height:30px;bottom:-35px;left:15px;animation-duration:6s;animation-delay:2s;"></div>
  <div class="bubble" style="width:35px;height:35px;bottom:-40px;right:-30px;animation-duration:8s;animation-delay:0.5s;"></div>

  <div class="card bg-white shadow-sm">
    <h3 class="mb-3">Login</h3>
    <div class="mb-2">
      <label for="languageSelect" class="form-label visually-hidden">Language</label>
      <select id="languageSelect" class="form-select form-select-sm w-auto">
        <option value="en">English</option>
        <option value="hi">हिन्दी</option>
        <option value="mr">मराठी</option>
      </select>
    </div>
    <form id="loginForm">
      <div class="mb-3 form-check form-switch">
        <input class="form-check-input" type="checkbox" id="adminMode">
        <label class="form-check-label" for="adminMode">Admin mode</label>
      </div>
      <div id="userFields">
        <div class="mb-3">
          <label class="form-label" for="mobile">Mobile</label>
          <input id="mobile" type="tel" class="form-control" required title="Mobile number" placeholder="Enter mobile number" />
        </div>
      </div>
      <div id="adminFields" style="display:none;">
        <div class="mb-3">
          <label class="form-label" for="adminUser">Admin Username</label>
          <div class="input-group">
            <input id="adminUser" class="form-control" title="Admin username" placeholder="Enter admin username" />
            <button id="autofillAdmin" type="button" class="btn btn-outline-secondary">Auto-fill</button>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label" for="adminPass">Admin Password</label>
          <input id="adminPass" type="password" class="form-control" title="Admin password" placeholder="Enter admin password" />
        </div>
      </div>
      <button id="btnLogin" class="btn btn-primary w-100" type="submit">Login</button>
    </form>
    <div id="msg" class="mt-3"></div>
    <div class="mt-3 text-end">
      <a href="{{url_for('register_page')}}">New user? Register</a>
    </div>
  </div>
    <script>
    // initialize language selector
    const langSelect = document.getElementById('languageSelect');
    const savedLang = localStorage.getItem('lang') || 'en';
    langSelect.value = savedLang;
    langSelect.addEventListener('change', function(){ localStorage.setItem('lang', this.value); });
    const adminModeCheckbox = document.getElementById('adminMode');
    adminModeCheckbox.addEventListener('change', function(){
      const isAdmin = this.checked;
      document.getElementById('userFields').style.display = isAdmin ? 'none' : '';
      document.getElementById('adminFields').style.display = isAdmin ? '' : 'none';
      // Toggle required attributes to avoid HTML5 validation on hidden fields
      const mobileEl = document.getElementById('mobile');
      const adminUserEl = document.getElementById('adminUser');
      const adminPassEl = document.getElementById('adminPass');
      if(mobileEl) mobileEl.required = !isAdmin;
      if(adminUserEl) adminUserEl.required = isAdmin;
      if(adminPassEl) adminPassEl.required = isAdmin;
      if(isAdmin){
        adminUserEl && adminUserEl.focus();
      } else {
        mobileEl && mobileEl.focus();
      }
    });
    document.getElementById('autofillAdmin').addEventListener('click', function(){
      document.getElementById('adminUser').value = 'admin';
      document.getElementById('adminPass').value = 'adminpass';
    });
    const loginForm = document.getElementById('loginForm');
    const btnLogin = document.getElementById('btnLogin');
    btnLogin.addEventListener('click', function(){
      console.log('Login button clicked, adminMode=', adminModeCheckbox.checked);
    });

    loginForm.addEventListener('submit', async function(e){
      e.preventDefault();
      if(adminModeCheckbox.checked){
        const user = document.getElementById('adminUser').value.trim();
        const pwd = document.getElementById('adminPass').value.trim();
        console.log('Attempting admin login with', user, '*****');
        try{
          const res = await fetch('https://scrs-0sgn.onrender.com/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:user,password:pwd})});
          const text = await res.text();
          let data = {};
          try{ data = JSON.parse(text); } catch(e){ data = { error: text }; }
          console.log('Admin login response status', res.status, data);
          if(res.ok){
            localStorage.setItem('adminToken', data.token);
            document.getElementById('msg').innerHTML = '<div class="alert alert-success">Admin logged in. Redirecting...</div>';
            setTimeout(()=> location.href='/admin/dashboard',800);
          } else {
            document.getElementById('msg').innerHTML = `<div class="alert alert-danger">${data.error||'Login failed'} (status ${res.status})</div>`;
          }
        }catch(err){
          console.error('Admin login fetch error', err);
          document.getElementById('msg').innerHTML = `<div class="alert alert-danger">Could not contact server: ${err.message}</div>`;
        }
      } else {
        const mobile = document.getElementById('mobile').value.trim();
        try{
          const res = await fetch('https://scrs-0sgn.onrender.com/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mobile})});
            const data = await res.json();
            if(res.ok){
              // store mobile and username for prediction linking and welcome
              localStorage.setItem('mobile', mobile);
              // prefer server-provided name, fallback to mobile if missing
              try{ localStorage.setItem('username', data.name || mobile); } catch(e){ localStorage.setItem('username', mobile); }
              console.log('Stored mobile and username in localStorage:', localStorage.getItem('mobile'), localStorage.getItem('username'));
              document.getElementById('msg').innerHTML = '<div class="alert alert-success">Logged in. Redirecting to prediction page...</div>';
              setTimeout(()=> location.href='/predict-page',900);
            } else {
              document.getElementById('msg').innerHTML = `<div class="alert alert-danger">${data.error||'Login failed'}</div>`;
            }
        }catch(err){
          document.getElementById('msg').innerHTML = '<div class="alert alert-danger">Could not contact server</div>';
        }
      }
    });
  </script>
   <script>
document.addEventListener("DOMContentLoaded", () => {
  const loginBox = document.querySelector(".card");
  const rect = loginBox.getBoundingClientRect();
  const bubbleLayer = document.body;

  function createBubble() {
    const bubble = document.createElement("div");
    bubble.className = "bubble";

    // random size
    const size = Math.floor(Math.random() * 30) + 20;
    bubble.style.width = size + "px";
    bubble.style.height = size + "px";

    // random animation duration
    bubble.style.animationDuration = (Math.random() * 5 + 5) + "s";

    // random position (avoid login box area)
    let x, y;
    do {
      x = Math.random() * window.innerWidth;
      y = Math.random() * window.innerHeight;
    } while (
      x > rect.left - size && x < rect.right + size &&
      y > rect.top - size && y < rect.bottom + size
    );

    bubble.style.left = x + "px";
    bubble.style.top = y + "px";

    bubbleLayer.appendChild(bubble);

    // remove after some time
    setTimeout(() => bubble.remove(), 15000);
  }

  // continuously spawn bubbles
  setInterval(createBubble, 1000);
});
</script>


    <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js")
    .then(reg => console.log("Service Worker registered:", reg))
    .catch(err => console.error("Service Worker registration failed:", err));
}
</script>


</body>
</html>














